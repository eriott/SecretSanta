extends layout

block content
    .container
        ul.nav.nav-tabs#myTab(role="tabList")
            li.nav-item
                a.nav-link.active#home-tab(data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true")
                    | Activities
            li.nav-item
                a.nav-link#profile-tab(data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false")
                    | My profile

        div.tab-content#myTabContent.mt-3
            div.tab-pane.fade.show.active#home(role="tabpanel" aria-labelledby="home-tab")
                  for event in events
                        div.rounded.border.border-secondary.mt-3
                            div.event-header.p-3
                                | #{event.name}
                            div.progress(style="height: 5px")
                                div.progress-bar.bg-info(role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100")
                            div.event-content.p-3
                                - if (event.addressee) {
                                    input.event-id(type="hidden" name="target" value="#{event.id}")
                                    div.postcard
                                        p
                                            span.postcard-item-header Кому
                                            span.postcard-item #{event.addressee.fullName}
                                        p
                                            span.postcard-item-header Куда
                                            span.postcard-item #{event.addressee.address}
                                        p
                                            span.postcard-item-header Об адресате
                                            span.postcard-item #{event.addressee.about}
                                    div.actions
                                        div.checkbox
                                            label
                                                input.isSent(type="checkbox", name="isSent", checked=(event.isGiftSent ? 'checked' : undefined))
                                                | I sent the gift
                                        div.checkbox
                                            label
                                                input.isReceived(type="checkbox", name="isReceived", checked=(event.isGiftReceived ? 'checked' : undefined))
                                                | I received the gift
                                - } else {
                                    div.empty-postcard
                                        p Nothing here yet!
                                        p You'll get an address at
                                        p
                                            span.sending-date #{event.endDate}
                                - }

            div.tab-pane.fade#profile(role="tabpanel" aria-labelledby="profile-tab")
                form(name="register-participant")
                    div.form-group
                        label(for="fullName") Полное ФИО
                        input.form-control#fullName(type="text", name="fullName", value="#{user.postData.fullName}")
                    div.form-group
                        label(for="address") Адрес
                        textarea.form-control#address(name="address", cols="40", rows="5")
                            | #{user.postData.address}
                    div.form-group
                        label(for="about") Расскажите о себе
                        textarea.form-control#about(name="about", cols="40", rows="10")
                            | #{user.about}
                    div.form-group
                        button#submit.btn.btn-primary
                            | Сохранить
                        label#reply

    script(type='text/javascript').
        $('#submit').click(function () {
            var data = {};
            data.fullName = $('#fullName').val();
            data.address = $('#address').val();
            data.about = $('#about').val();

            $('#reply').css('opacity', '1').text("Сохраняю...");
            $.post('/update_profile', data, function (result) {
                $('#reply').text("Сохранено.").delay(2000).animate({opacity:0});
            })
        })

        $('.isSent').change(function () {
            var event = {};
            event.id = $(this).parents('.event-content').find('.event-id').val();
            event.isGiftSent = this.checked;
            $.post('/update_event', event)
        })

        $('.isReceived').change(function () {
            var event = {};
            event.id = $(this).parents('.event-content').find('.event-id').val();
            event.isGiftReceived = this.checked;
            $.post('/update_event', event)
        })